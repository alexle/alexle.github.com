<!DOCTYPE html>
<html amp lang="en">
<head>
   <meta charset="utf-8">
   <script async src="https://cdn.ampproject.org/v0.js"></script>
   <meta name="google-site-verification" content="UNRfpImcRQ3BIYIbiTDAv7O_9dJy-L3rcmWchHTi_Vc" />
   <meta name="msvalidate.01" content="8F7A5DB489A40721CBADB9FED30E8A1D" />
   <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1" />
   <meta name="description" content="A tutorial on how to send Netflix OAuth requests in Python." />
   <link rel="canonical" href="http://alexanderle.com/blog/2013/sending-netflix-oauth-request-python.html" />
   <title>Sending Netflix OAuth Requests With Python | Alex Le</title>

   <!-- AMP -->
   <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>

   <!-- AMP Components -->
   <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
   <script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script>

   <!-- Pure -->
   <link rel="stylesheet" href="https://yui-s.yahooapis.com/pure/0.6.0/pure-min.css">
   <link rel="stylesheet" href="https://yui-s.yahooapis.com/pure/0.6.0/grids-responsive-min.css">

   <!-- Javascript and Stylesheets -->
   <script type="text/javascript" src="/css/prism.js"></script>
   <!--
   <link rel="stylesheet" type="text/css" href="/css/blog.css">
   -->
   <!--
   <link rel="stylesheet" type="text/css" href="/css/prism.css">
   -->
   <link rel="alternate" type="application/rss+xml" title="RSS" href="http://alexanderle.com/rss.xml">

   <!-- Fonts -->
   <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
   <link href="https://fonts.googleapis.com/css?family=Raleway:200,400" rel="stylesheet" type="text/css">

   <!-- AMP Custom CSS -->
   <style amp-custom>
   g* {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}

html, button, input, select, textarea,
.pure-g [class *= "pure-u"] {
   font-family: 'Open Sans', sans-serif;
}

:root {
   --main_color: #333333;
   --home_post_caption_color: #777;
   --home_post_caption_size: 80%;
}

/* LAYOUT */
#wrapper {
   max-width: 37em;
   margin: 0 auto;
}

#header h1 {
   font-family: 'Raleway', sans-serif;
   font-size: 3em;
   font-weight: 400;
   text-align: center;
   line-height: 1.4em;
   margin: 0em;
}

#header a { color: var(--main_color); }

#subheader h2 {
   font-family: 'Raleway', sans-serif;
   font-size: 1.4em;
   font-weight: 200;
   text-align: center;
   line-height: 1.4em;
   margin: 0 0 0.2em 0;
}

#hr-header {
   border-bottom: 1px solid #eeeeee;
   margin-top: 1em;
}

#content { margin: 1.0em; }

#footer {
   margin: 1.5em 0 1em 0;
   text-align: center;
}

#footer a, .copyright { color: #999999; }

#footer .pure-menu a:hover, .pure-menu a:focus {
   background: none;
}

#footer .pure-menu-link {
   font-size: 0.9em;
   padding: 0.5em 0.5em;
}

#footer .copyright {
   font-size: 0.7em;
   padding: 0.5em 0.5em;
}

/* BASE CSS */
body {
   font-size: 1.1em;
   line-height: 1.55em;
   color: var(--main_color);
}

h1 { font-size: 1.6em; }
h2 { font-size: 1.5em; }
h3 { font-size: 1.3em; }
h4 { font-size: 1.1em; }

h1,h2,h3,h4,h5,h6 {
   font-weight: normal;
   text-rendering: optimizelegibility;
   line-height: 1.4em;
}

/* LINK CSS */
a {
   cursor: hand;
   text-decoration: none;
   color: rgb(61, 146, 201);
}

a:link, a:visited {
   color: #E87000;
   text-decoration: none;
}

a:hover, a:focus {
   text-decoration: none;
}

/* ABOUT CSS */
.about-title, .photo-title { font-size: 1.7em; }

/* HOME CSS */
a.home-title-link:link, a.home-title-link:visited, a.home-title-link:hover {
   color: var(--main-color);
}

h1.home-title, h2.home-title, h3.home-title, h1.post-title-link {
   margin-bottom: 0.2em;
}

.home-date, .post-date {
   color: var(--home_post_caption_color);
   font-size: var(--home_post_caption_size);
}

.home-image {
   margin: 0.7em 0 1.6em 0;
   overflow: hidden;
   position: relative;
   border: 1px;
   height: 220px;
}

.home-image img {
   position: absolute;
   left: 50%;
   top: 50%;
   transform: translate(-50%, -50%);
}

.home-snippet {
   margin-top: 0.6em;
   margin-bottom: 1.2em;
}

/* POST CSS */
.post-title { }
.post-footer-left { float: left; }
.post-footer-right { float: right; }

/* ARCHIVE CSS */
.archive-year {
   font-size: 2em;
   text-align: center;
}

/* PHOTO CSS */
.pure-g.gutters { margin: 0 -0.2em; }

.pure-g.gutters > [class *=pure-u]{
  box-sizing: border-box;
  padding: 0em 0.2em;
}

.album { padding: 0.2em 0 0.2em 0; }

/* COMPONENTS */
img.center {
   display: block;
   margin-left: auto;
   margin-right: auto;
}

.separator {
   clear: both;
   text-align: center;
   color: var(--home_post_caption_color);
   font-size: var(--home_post_caption_size);
}

.button-list { text-align: center; }

.button-item {
   font-size: 90%;
   margin: 0 0.8em 0 0.8em;
}

a.button-item { color: #E87000; }

.hr-post { border-top: 1px solid #eeeeee; }

blockquote {
   position: relative;
   font-style: italic;
   font-size: 1.15em;
   line-height: 1.5em;
   margin-top: 1em;
   padding-left: 0.2em;
}

blockquote:before {
    position: absolute;
    font-size: 2.8em;
    top: 0.20em;
    left: -0.5em;
    content: "\201C";
}

pre {
   font-family: courier;
   font-size: 13px;
}

/* RESPONSIVE -- Rules GREATER 48em */
@media (min-width: 48em) {
}

/* RESPONSIVE -- Rules LESS 48em */
@media (max-width: 48em) {
   #content {
      max-width: 100%;
      margin-top: 0.5em;
   }

   body { font-size: 0.95em; }
}

/* RESPONSIVE -- Rules LESS 30em */
@media (max-width: 30em) {
   #header h1 {
      font-size: 2.8em;
   }

   #subheader h2 {
      font-size: 1.2em;
   }

   h1 { font-size: 1.4em; }
   h2 { font-size: 1.35em; }
   h3 { font-size: 1.2em; }

   .home-image { height: 160px; }

   .button-item { font-size: 100%; }

   .about-title, .photo-title { font-size: 1.5em; }
   .archive-year {font-size: 1.8em; }
}
/* http://prismjs.com/download.html?themes=prism-okaidia&languages=markup+css+clike+javascript+autohotkey+bash+c+csharp+cpp+coffeescript+ruby+git+haml+http+java+json+less+makefile+markdown+objectivec+perl+php+pure+python+typescript+vim+wiki+yaml */
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #f8f8f2;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}


   </style>
</head>

<body>

<amp-analytics type="googleanalytics" id="analytics1">
<script type="application/json">
{
   "vars": {
      "account": "UA-28947728-1"
   },
   "triggers": {
      "trackPageview": {
         "on": "visible",
         "request": "pageview"
      },
      "trackEvent": {
         "selector": "#event-test",
         "on": "click",
         "request": "event",
         "vars": {
            "eventCategory": "ui-components",
            "eventAction": "click"
         }
      }
   }
}
</script>
</amp-analytics>

<div id="wrapper" class="pure-g">
   <!-- CONTENT -->
   <div id="content" class="pure-u-1-1">
      <!-- HEADER -->
      <div id="header">
         <h1><a href="/">Alex Le</a></h1>
      </div>
      <div id="subheader">
         <h2>Firmware Engineer, Minimalist, Improving Runner</h2>
      </div>
      <ul class="button-list pure-menu-list">
         <a class="button-item" href="/about.html">About</a>
         <a class="button-item" href="/blog/archives.html">Blog</a>
         <a class="button-item" href="/photos.html">Photos</a>
      </ul>
      <div id="hr-header"></div>

      <!-- BODY -->
      <article>
         
<div class="post">
   <div class="post-title">
      <h1 class="post-title-link">Sending Netflix OAuth Requests With Python</h1>
   </div>

   <div class="post-date">
      Feb 24, 2013
   </div>

   <p>
      <p>Oauth is an authentication protocol which allows users to grant a third-party access to their resources - without sharing their password. Kind of similar to creating a temporary key to your car for someone, a key which can have chosen limitations and be disabled at any time. Great for users. Confusing for newbies like me working with it.</p>
<p>That's because each service can have a different method to "hand-shake" between the user and consumer. In a previous <a href="/blog/2012/neatflix-my-netflix-api-demo.html">post</a>, I shared a <a href="http://neatflix.appspot.com/">demo</a> which uses the Netflix API. It was my first experience with Oauth and it took me a while to understand all the nuances involved. Here, I'll detail how I sent non-authenticated and authenticated signed requests to Netflix with Python.</p>
<h2>Before You Start</h2>
<ol>
<li>Register your application at <a href="http://developer.netflix.com/apps/register/">http://developer.netflix.com/apps/register/</a>. A unique consumer key and secret is provided to you afterwards. Keep this for later.</li>
<li>Go over the Netflix <a href="http://developer.netflix.com/docs/Security">Authentication Overview</a>. This contains all the required info to make Netflix API requests. It also has nice information containing common REST API tasks you can send.</li>
</ol>
<h2>Performing A Non-Authenticated Request</h2>
<p>The "autocomplete catalog" request searches the Netflix catalog for movies and tv shows which partially match the search string. It's a <em>non-authenticated</em> request and only requires the consumer key and a percent-encoded search string. The format of the request is as follows:</p>
<pre><code class=language-html>http://api-public.netflix.com/catalog/titles/autocomplete?oauth_consumer_key=CONSUMER_KEY&term=SEARCH_STRING
</code></pre>

<p>To fetch the data in Python, the urllib library is used to send the request, created from the base URL and parameters:</p>
<pre><code class=language-python>import urllib
from xml.etree import ElementTree as ET

auto_url = "http://api-public.netflix.com/catalog/titles/autocomplete"

auto_parameters = [
     ('term', search_string),
     ('oauth_consumer_key', CONSUMER_KEY)]

full_auto_url = auto_url + '?' + urllib.urlencode(auto_parameters)

# Read autocomplete url
auto_data = urllib.urlopen(full_auto_url)
</code></pre>

<p>Extracting the Netflix data returned can be done by converting the XML response to an Element Object with the ElementTree library. Once in this tree-format, it can be traversed and parsed with the built-in functions:</p>
<pre><code class=language-python>auto_xml = ET.fromstring(auto_data)

# Grab all titles from autocomplete search
for i in auto_xml.findall('.//title'):
     names = i.attrib.get('short')
</code></pre>

<h2>Performing An Authenticated Signed Request</h2>
<p>The "catalog titles" search returns detailed information on a film and is an example of an <em>authenticated signed</em> request. It involves 4 steps prior to sending the request:</p>
<ol>
<li>Setting the base URL</li>
<li>Gathering the parameters</li>
<li>Creating the base string</li>
<li>Calculating the signature</li>
</ol>
<p>Combining these components produces the signed request, which has the format below:</p>
<pre><code class=language-html>http://api-public.netflix.com/PATH?parameter=PARM&oauth_consumer_key=CONSUMER_KEY&oauth_nonce=NONCE&oauth_signature_method=HMAC-SHA1&oauth_timestamp=TIME_STAMP&oauth_version=1.0&oauth_signature=SIGNATURE
</code></pre>

<p>While this may look daunting, it's not too bad once broken down. First, decide what Netflix resource you want to access (catalog/people, users/current, etc). In this example, we want more information on a particular title so we use the catalog/titles resource. The base URL thus looks like:</p>
<pre><code class=language-html>TITLE_URL = 'http://api-public.netflix.com/catalog/titles'
</code></pre>

<p>Second, we gather the required OAuth parameters for the Netflix request.</p>
<ul>
<li>
<p><strong>parm</strong> - Optional parameter(s) which specify what data is returned. For the catalog titles search, we use the "term" parameter along with the movie/tv's title to gather the film's details.</p>
</li>
<li>
<p><strong>consumer_key</strong> - Your application's consumer key.</p>
</li>
<li>
<p><strong>nonce</strong> - Random string of characters to distinguish each request from one another.</p>
</li>
<li>
<p><strong>oauth_method</strong> - This is always HMAC-SHA1.</p>
</li>
<li>
<p><strong>time_stamp</strong> - Number of seconds since epoch (Jan 1st, 1970).</p>
</li>
<li>
<p><strong>oauth_version</strong> - This is 1.0 for now.</p>
</li>
</ul>
<p>Although not required for the base string, we'll later need the parameters to be in alphabetical order, so it's easier to keep them in order from the start.</p>
<pre><code class=language-python>from hashlib import sha1
import hmac, binascii, urllib, time, string, random

def RandomString( size=6, chars=string.ascii_uppercase + string.digits ):
   return ''.join( random.choice(chars) for x in range(size) )

expand_parms = 'synopsis,cast,formats,@episodes,@seasons'
nonce = RandomString()
time_stamp = time.time()

parameters = [
   ('expand', expand_parms),
   ('max_results', '1'),
   ('oauth_consumer_key', CONSUMER_KEY),
   ('oauth_nonce', nonce),
   ('oauth_signature_method', 'HMAC-SHA1'),
   ('oauth_timestamp', time_stamp),
   ('oauth_version', '1.0'),
   ('term', term)]
</code></pre>

<p>Next, we create the base string by joining the HTTP method (GET/POST), base URL, and parameters (all percent-encoded):</p>
<pre><code class=language-python># Put together base string
param_encode = urllib.urlencode(parameters).replace('+', '%20')

base_string = 'GET&' + OAuthEscape( TITLE_URL ) + '&' + OAuthEscape(param_encode)
</code></pre>

<p>The last piece of data to collect is the signature of the base string. This is calculated by passing your consumer <strong>secret</strong> and the base string to the HMAC-SHA1 hashing algorithm. Also, the result of the HMAC function needs to be base64 encoded, turning it from an unreadable binary string into readable characters:</p>
<pre><code class=language-python>def OAuthEscape( s ):
   return urllib.quote( s, '' )

def GenerateSig( base_string ):
   secret =  NET_SECRET + '&'
   hashed = hmac.new(secret, base_string , sha1)

signed_sig = binascii.b2a_base64(hashed.digest())[:-1]

return signed_sig

sign = GenerateSig( base_string )
</code></pre>

<p>With the base URL, parameters, and signature set up, all that's left is to combine them together and make the request:</p>
<pre><code class=language-python>parameters.append(('oauth_signature', sign))

full_url = TITLE_URL + '?' + urllib.urlencode(parameters)

# Read catalog url
title_data = urllib.urlopen(full_url)

xml = ET.fromstring(title_data)
</code></pre>

<p>This basic tutorial only brushes the surface of what the Netflix API has available. To see the original code, feel free to <a href="https://github.com/alexle/Neatflix">fork my Neatflix demo</a> from Github. Try the example above or see if you can gather data from another Netflix resource. The sky is the limit on what cool applications you can conjure up.</p>
   </p>

   <div class="post-footer-left">
      <amp-social-share type="twitter" width="2em" height="1.8em"></amp-social-share>
      <amp-social-share type="gplus" width="2em" height="1.8em"></amp-social-share>
      <amp-social-share type="linkedin" width="2em" height="1.8em"></amp-social-share>
      <amp-social-share type="facebook" width="2em" height="1.8em" data-param-app_id="822338341250063"></amp-social-share>
   </div>

   <div class="post-footer-right">
      <a href="/">&larr; back to home page</a>
   </div>

   <div class="separator"> </div>
</div>

      </article>

      <!-- FOOTER -->
      <div id="footer">
         <hr class="hr-post">
         <div class="pure-menu pure-menu-horizontal">
            <ul class="pure-menu-list">
               <li class="pure-menu-item"><a href="https://twitter.com/alextrle" title="Twitter" target="_blank" class="pure-menu-link">Twitter</a></li>
               <li class="pure-menu-item"><a href="https://www.linkedin.com/in/alexle" title="LinkedIn" target="_blank" class="pure-menu-link">LinkedIn</a></li>
               <li class="pure-menu-item"><a href="https://github.com/alexle" title="Github" target="_blank" class="pure-menu-link">GitHub</a></li>
               <li class="pure-menu-item"><a href="http://www.strava.com/athletes/alexle" title="Strava" target="_blank" class="pure-menu-link">Strava</a></li>
               <li class="pure-menu-item"><a href="/rss.xml" title="RSS" target="_blank" class="pure-menu-link">RSS</a></li>
               <li class="pure-menu-item"><a rel="author" href="https://plus.google.com/u/0/101315815319989778966?rel=author" title="Google+" target="_blank"></a></li>
            </ul>
         </div> <!-- end pure-menu -->
         <div class='copyright'>Copyright &copy; 2017 Alex Le</div>
      </div> <!-- end FOOTER -->

   </div> <!-- end CONTENT -->

</div> <!-- end WRAPPER -->

</body>
</html>